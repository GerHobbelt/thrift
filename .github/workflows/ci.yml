name: ci

on:
  pull_request:
  push:
    branches:
      - 'v1.x'
      - 'v2.x'
    tags:
      - v*

jobs:
  build:
    name: Build the thrift compiler
    strategy:
      matrix:
        os: [ubuntu-20.04, macos-10.15]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Generate build configuration
        run: |
          cmake -DBUILD_COMPILER=ON -DBUILD_LIBRARIES=OFF -DBUILD_TESTING=OFF \
                -DBUILD_EXAMPLES=OFF -DTYPES_PREFIX=/home/runner/work .
      - name: Build
        run: |
          cmake --build . --config Release
      # - name: Get Package Version
      #   if: contains(github.ref, 'refs/tags/v')
      #   id: pkg_version
      #   run: echo ::set-output name=VERSION::${GITHUB_REF#refs/tags/v}
      # - name: Create a new Release
      #   if: contains(github.ref, 'refs/tags/v')
      #   uses: "marvinpinto/action-automatic-releases@v1.2.1"
      #   with:
      #     repo_token: "${{ secrets.GITHUB_TOKEN }}"
      #     automatic_release_tag: "${{ steps.pkg_version.outputs.VERSION }}"
      #     title: "${{ steps.pkg_version.outputs.VERSION }}"
      #     files: |
      #       bin/thrift
